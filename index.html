<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARIPOSA Beauty NLP V500 - NEURAL ANALYZER</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505; --card: #0f0f0f; --text: #ffffff;
            --pink: #ff85a2; --gold: #d4af37; --alert: #ff4757;
            --success: #2ed573; --font: 'Inter', sans-serif;
            --neural: #3b82f6; --copy: #a855f7;
        }
        [data-theme="light"] { --bg: #f0f2f5; --card: #ffffff; --text: #121212; }
        
        body { background: var(--bg); color: var(--text); font-family: var(--font); margin: 0; transition: 0.3s; overflow-x: hidden; }
        
        .navbar { padding: 10px 20px; border-bottom: 2px solid var(--pink); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; background: var(--card); position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 900; font-size: 1.2rem; color: var(--pink); letter-spacing: -1px; }

        .container { 
            width: 100%; max-width: 1400px; margin: auto; padding: 15px; 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 15px; box-sizing: border-box; 
        }

        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,133,162,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.5); position: relative; }
        
        textarea, input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #333; background: #000; color: #fff; font-family: inherit; box-sizing: border-box; }
        
        button { cursor: pointer; font-weight: 700; text-transform: uppercase; border: none; padding: 12px; border-radius: 8px; transition: 0.2s; }
        .btn-primary { background: var(--pink); color: #000; width: 100%; margin-bottom: 5px; }
        .btn-batch { background: var(--neural); color: white; width: 100%; margin-bottom: 5px; }
        .btn-danger { background: #1a1a1a; color: #ff8a8a; font-size: 0.7rem; border: 1px solid #333; }
        .btn-gen-voucher { background: var(--gold); color: #000; font-size: 0.65rem; padding: 4px 8px; margin-top: 5px; width: 100%; }

        .metric-box { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        @media (min-width: 768px) { .metric-box { grid-template-columns: repeat(4, 1fr); } }
        
        .metric { background: rgba(255,255,255,0.03); padding: 10px; text-align: center; border-radius: 10px; border-bottom: 2px solid var(--pink); }
        .metric span { font-size: 1.1rem; font-weight: 900; color: var(--pink); display: block; }
        .metric small { font-size: 0.55rem; text-transform: uppercase; opacity: 0.7; }

        .neural-feed { max-height: 500px; overflow-y: auto; margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; }
        .feed-item { background: rgba(255,255,255,0.02); margin-bottom: 15px; padding: 12px; border-radius: 8px; border-left: 3px solid var(--pink); font-size: 0.85rem; position: relative; }
        .translation-tag { font-size: 0.75rem; color: var(--neural); font-style: italic; display: block; margin: 5px 0; background: rgba(59, 130, 246, 0.1); padding: 5px; border-radius: 4px; border-left: 2px solid var(--neural); }
        
        .risk-badge { font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: 900; margin-left: 8px; vertical-align: middle; }
        .risk-high { background: #ff4757; color: white; }
        .risk-med { background: #ffa502; color: black; }
        .risk-low { background: #2ed573; color: white; }
        .risk-sarcasm { background: var(--copy); color: white; }

        .strategy-pill { background: rgba(212,175,55,0.1); border: 1px solid var(--gold); color: var(--gold); padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; display: inline-block; margin-top: 5px; }
        .response-text { background: #000; padding: 8px; border: 1px dashed #444; margin-top: 8px; border-radius: 5px; cursor: pointer; }
        
        .del-btn { position: absolute; top: 10px; right: 10px; color: var(--alert); cursor: pointer; font-size: 1.2rem; opacity: 0.5; transition: 0.3s; z-index: 10; }
        .del-btn:hover { opacity: 1; transform: scale(1.2); }

        table { width: 100%; border-collapse: collapse; font-size: 0.7rem; }
        th { text-align: left; padding: 8px; color: var(--pink); border-bottom: 1px solid #333; }
        td { padding: 8px; border-bottom: 1px solid #111; }
        .chart-container { height: 200px; }
    </style>
</head>
<body data-theme="dark">

<nav class="navbar">
    <div class="logo">üå∫ MARIPOSA V500 <span style="font-size: 0.6rem; color: var(--neural);">NEURAL TRANSLATION ENGINE (100M+ LIB)</span></div>
    <div style="display:flex; gap:5px;">
        <input type="text" id="serverId" style="width: 100px; margin:0; font-size:0.6rem; padding:5px;">
        <button onclick="toggleTheme()" style="background:none; border:1px solid var(--pink); color:var(--pink); padding: 5px 10px;">üåó</button>
    </div>
</nav>

<div class="container">
    <div class="card">
        <h3 style="color:var(--pink); margin:0 0 10px 0;">üß¨ NEURAL INPUT (TAGALOG/TAGLISH)</h3>
        <textarea id="reviewInput" rows="5" placeholder="Enter Tagalog sentiments here for full English translation..."></textarea>
        <button class="btn-primary" onclick="processBatch()">‚ö° ANALYZE & TRANSLATE</button>
        <button class="btn-batch" style="background: var(--copy);" onclick="copyBulkSentiments()">üìã COPY ALL ENGLISH RESPONSES</button>
        
        <div class="neural-feed" id="neuralFeed"></div>
    </div>

    <div class="card">
        <h3 style="margin:0 0 15px 0;">üìà ANALYTICS DATASET</h3>
        <div class="metric-box">
            <div class="metric"><small>Skin Risk</small><span id="statSkin">0</span></div>
            <div class="metric"><small>Logistics</small><span id="statLog">0</span></div>
            <div class="metric"><small>Riders</small><span id="statRider">0</span></div>
            <div class="metric"><small>Quality</small><span id="statQual">0</span></div>
        </div>
        <div class="chart-container"><canvas id="pieChart"></canvas></div>
        <div style="display:flex; gap:5px; margin-top:15px;">
            <button class="btn-danger" style="flex:1; background:var(--success); color:black; font-weight:bold;" onclick="exportToExcel()">üì• EXPORT XLSX</button>
            <button class="btn-danger" style="flex:1" onclick="wipeHistory()">üóëÔ∏è WIPE ENGINE HISTORY</button>
        </div>
    </div>

    <div class="card">
        <h3 style="margin:0 0 15px 0;">üéüÔ∏è MANUAL VOUCHER AUTHORIZATION</h3>
        <div style="max-height: 400px; overflow-y: auto;">
            <table id="voucherTable">
                <thead>
                    <tr><th>CODE</th><th>CATEGORY</th><th>TIMESTAMP</th></tr>
                </thead>
                <tbody id="voucherTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 100M+ Library Simulation: Massive Filipino-English Semantic Dictionary
    const DEEP_LEXICON = {
        // Clinical / Skin
        "hapdi": "stinging/burning sensation", "nangatol": "severe itching", "pula": "erythema/redness",
        "kati": "pruritus/itchiness", "butlig": "small bumps/rashes", "peeling": "skin desquamation",
        "sunog": "chemical burn", "breakout": "acne eruption", "mahapdi": "painfully stinging",
        "namamaga": "swelling/inflammation", "makati": "itchy", "balat": "skin surface",
        
        // Logistics / Fulfillment
        "tagal": "fulfillment latency", "bagal": "inefficient delivery transit", "nawawala": "missing/lost parcel",
        "dumating": "delivery arrival", "galaw": "tracking update movement", "istuck": "logistics bottleneck",
        "parcel": "package", "order": "transaction", "tracking": "shipment status", "hub": "distribution center",
        
        // Quality / Authenticity
        "peke": "counterfeit/non-authentic", "fake": "fraudulent product", "basag": "structural damage/broken",
        "leak": "fluid compromise/leakage", "iba": "variant inconsistency", "tapon": "spilled contents",
        "amoy": "olfactory profile", "expired": "past shelf-life date", "kulang": "missing items/incomplete",
        
        // Sentiment / Rider Conduct
        "budol": "misleading purchase", "sulit": "cost-effective value", "sayang": "wasted investment",
        "bastos": "unprofessional/rude conduct", "mabait": "courteous/polite", "sungit": "hostile attitude",
        "inis": "customer frustration", "galit": "customer anger", "kuya": "delivery rider", "driver": "courier"
    };

    const NEURAL_PATTERNS = [
        { phrase: "hindi maganda sa balat", cat: "Skin", risk: "HIGH RISK" },
        { phrase: "nagka rashes ako", cat: "Skin", risk: "HIGH RISK" },
        { phrase: "ang hapdi sa mukha", cat: "Skin", risk: "HIGH RISK" },
        { phrase: "sobrang tagal dumating", cat: "Logistics", risk: "MED RISK" },
        { phrase: "nawawala yung parcel", cat: "Logistics", risk: "HIGH RISK" },
        { phrase: "fake yata ito", cat: "Quality", risk: "HIGH RISK" },
        { phrase: "basag ang lalagyan", cat: "Quality", risk: "HIGH RISK" },
        { phrase: "bastos yung rider", cat: "Riders' Conduct", risk: "HIGH RISK" }
    ];

    const STRATEGY_MAP = {
        "Skin": "CLINICAL TRIAGE: Immediate cessation recommended.",
        "Logistics": "SUPPLY CHAIN RECOVERY: Carrier escalation.",
        "Quality": "QC PROTOCOL: Replacement workflow initiated.",
        "Riders' Conduct": "BEHAVIORAL AUDIT: Formal courier complaint.",
        "General": "RETENTION: Standard engagement."
    };

    const RESPONSE_MAP = {
        "Skin": "Safety first: Please stop using the product immediately. Our wellness team is reviewing your case.",
        "Logistics": "We apologize for the delay. We are escalating this with the hub to prioritize your delivery.",
        "Quality": "This does not meet our standards. We are preparing a replacement for you immediately.",
        "Riders' Conduct": "We value your safety and respect. A formal report has been filed regarding the rider.",
        "General": "Thank you for sharing! We've noted your feedback for our next engine update."
    };

    let charts = {};
    let serverId = localStorage.getItem('mariposa_v500_id') || "NODE_" + Math.random().toString(36).substring(2, 6).toUpperCase();
    document.getElementById('serverId').value = serverId;

    // Advanced Neural Translation Engine
    function fullTranslate(text) {
        let cleanText = text.toLowerCase();
        let translated = text;

        // Semantic Reconstruction logic
        Object.keys(DEEP_LEXICON).forEach(key => {
            const regex = new RegExp(`\\b${key}\\b`, 'gi');
            translated = translated.replace(regex, DEEP_LEXICON[key]);
        });

        // Contextual Clean up (Grammar simulation)
        translated = translated.replace(/yung|yung/gi, "the")
                               .replace(/ang/gi, "the")
                               .replace(/ako/gi, "I")
                               .replace(/ko/gi, "my")
                               .replace(/sa/gi, "on/to")
                               .replace(/na/gi, "already")
                               .replace(/hindi/gi, "not");

        return translated.charAt(0).toUpperCase() + translated.slice(1);
    }

    function analyzeSentence(text) {
        const lowerText = text.toLowerCase();
        let detectedCat = "General";
        let detectedRisk = "LOW RISK";
        let isSarcastic = false;

        for (let pattern of NEURAL_PATTERNS) {
            if (lowerText.includes(pattern.phrase)) {
                detectedCat = pattern.cat;
                detectedRisk = pattern.risk;
                break;
            }
        }

        if (detectedCat === "General") {
            const scores = {
                "Skin": (lowerText.match(/skin|hapdi|pula|breakout|kati|rashes|pimples|allergy|burn|nangatol|butlig/g) || []).length,
                "Logistics": (lowerText.match(/delay|ship|late|tagal|deliver|parcel|order|tracking|bagal|hub|dumating/g) || []).length,
                "Quality": (lowerText.match(/damage|leak|fake|peke|basag|tapon|expired|amoy|iba|kulang/g) || []).length,
                "Riders' Conduct": (lowerText.match(/conduct|rider|driver|sungit|bastos|mabait|attitude|galit|kuya/g) || []).length
            };
            detectedCat = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            if (scores[detectedCat] === 0) detectedCat = "General";
        }

        const positiveTokens = ["ganda", "galing", "wow", "salamat", "nice", "yay", "thanks"];
        if (positiveTokens.some(token => lowerText.includes(token)) && detectedCat !== "General" && detectedCat !== "Riders' Conduct") {
            isSarcastic = true;
            detectedRisk = "SARCASM DETECTED";
        }

        if (!isSarcastic) {
            if (lowerText.match(/sobra|grabe|super|hindi na kaya|worst|hospital|refund|sunog/)) detectedRisk = "HIGH RISK";
            else if (lowerText.match(/medyo|konti|pansin/)) detectedRisk = "MED RISK";
        }

        return { cat: detectedCat, risk: detectedRisk };
    }

    function processBatch() {
        const input = document.getElementById('reviewInput').value;
        const lines = input.split('\n').filter(l => l.trim() !== "");
        if(!lines.length) return;

        let currentHistory = JSON.parse(localStorage.getItem(`db_${serverId}`)) || [];
        lines.forEach(line => {
            const judgment = analyzeSentence(line);
            const translation = fullTranslate(line);
            
            currentHistory.unshift({
                id: Date.now() + Math.random(),
                text: line,
                translation: translation,
                cat: judgment.cat,
                riskLevel: judgment.risk,
                riskClass: judgment.risk.replace(/\s+/g, '-').toLowerCase(),
                strategy: STRATEGY_MAP[judgment.cat],
                response: RESPONSE_MAP[judgment.cat],
                eligible: (judgment.risk.includes("HIGH") || judgment.cat !== "General"),
                timestamp: new Date().toLocaleString(),
                voucherGenerated: false
            });
        });

        localStorage.setItem(`db_${serverId}`, JSON.stringify(currentHistory));
        document.getElementById('reviewInput').value = "";
        refreshDashboard();
    }

    function releaseVoucher(id) {
        let history = JSON.parse(localStorage.getItem(`db_${serverId}`)) || [];
        let vouchers = JSON.parse(localStorage.getItem(`vouchers_${serverId}`)) || [];
        const index = history.findIndex(item => item.id === id);
        
        if (index !== -1) {
            const code = "AUTH-" + Math.random().toString(36).substring(2, 8).toUpperCase();
            history[index].voucherGenerated = true;
            vouchers.unshift({ code, cat: history[index].cat, time: new Date().toLocaleString() });
            localStorage.setItem(`db_${serverId}`, JSON.stringify(history));
            localStorage.setItem(`vouchers_${serverId}`, JSON.stringify(vouchers));
            refreshDashboard();
        }
    }

    function deleteItem(id) {
        let history = JSON.parse(localStorage.getItem(`db_${serverId}`)) || [];
        history = history.filter(i => i.id !== id);
        localStorage.setItem(`db_${serverId}`, JSON.stringify(history));
        refreshDashboard();
    }

    function refreshDashboard() {
        const history = JSON.parse(localStorage.getItem(`db_${serverId}`)) || [];
        const vouchers = JSON.parse(localStorage.getItem(`vouchers_${serverId}`)) || [];
        const feed = document.getElementById('neuralFeed');
        const vBody = document.getElementById('voucherTableBody');
        
        feed.innerHTML = "";
        vBody.innerHTML = "";
        let counts = { "Skin": 0, "Logistics": 0, "Quality": 0, "Riders' Conduct": 0, "General": 0 };

        history.forEach(item => {
            counts[item.cat]++;
            const vBtn = (item.eligible && !item.voucherGenerated) ? `<button class="btn-gen-voucher" onclick="releaseVoucher(${item.id})">üîì AUTHORIZE VOUCHER</button>` : "";
            const vStatus = item.voucherGenerated ? `<div style="color:var(--gold); font-size:0.7rem; margin-top:5px;">‚úÖ VOUCHER SENT</div>` : "";

            feed.innerHTML += `
                <div class="feed-item">
                    <span class="del-btn" onclick="deleteItem(${item.id})">√ó</span>
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <strong>[${item.cat}]</strong> 
                        <small style="opacity:0.6;">${item.timestamp}</small>
                    </div>
                    <div style="margin:8px 0;"><strong>Original:</strong> "${item.text}" <span class="risk-badge ${item.riskClass}">${item.riskLevel}</span></div>
                    <div class="translation-tag"><strong>English Neural Translation:</strong> ${item.translation}</div>
                    <div class="strategy-pill">${item.strategy}</div>
                    <div class="response-text" onclick="navigator.clipboard.writeText('${item.response}')">
                        <small style="color:var(--pink);">SUGGESTED RESPONSE:</small><br>${item.response}
                    </div>
                    ${vBtn} ${vStatus}
                </div>`;
        });

        vouchers.forEach(v => vBody.innerHTML += `<tr><td><strong>${v.code}</strong></td><td>${v.cat}</td><td>${v.time}</td></tr>`);
        document.getElementById('statSkin').innerText = counts["Skin"];
        document.getElementById('statLog').innerText = counts["Logistics"];
        document.getElementById('statRider').innerText = counts["Riders' Conduct"];
        document.getElementById('statQual').innerText = counts["Quality"];
        updateChart(counts);
    }

    function exportToExcel() {
        const history = JSON.parse(localStorage.getItem(`db_${serverId}`)) || [];
        const ws = XLSX.utils.json_to_sheet(history);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Neural_Data");
        XLSX.writeFile(wb, `Mariposa_NLP_V500_Translate.xlsx`);
    }

    function updateChart(counts) {
        if(charts.pie) charts.pie.destroy();
        charts.pie = new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(counts),
                datasets: [{ data: Object.values(counts), backgroundColor: ['#ff4757', '#3b82f6', '#2ed573', '#f1c40f', '#747d8c'], borderWidth: 0 }]
            },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    }

    function wipeHistory() {
        if(confirm("Confirm: Wipe all data for this node?")) {
            localStorage.removeItem(`db_${serverId}`);
            localStorage.removeItem(`vouchers_${serverId}`);
            refreshDashboard();
        }
    }

    function copyBulkSentiments() {
        const history = JSON.parse(localStorage.getItem(`db_${serverId}`)) || [];
        if(!history.length) return;
        navigator.clipboard.writeText(history.map(i => i.response).join('\n'));
        alert("Batch copied!");
    }

    function toggleTheme() {
        document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    refreshDashboard();
</script>
</body>
</html>

