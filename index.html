<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D.Z. Mariposa NLP v12 - Batch Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --mariposa-pink: #ff85a2; --mariposa-hot: #d63384;
            --mariposa-black: #121212; --mariposa-dark-grey: #1e1e1e;
            --white: #ffffff; --critical: #ff4757; --pos: #2ed573; 
        }
        
        body { font-family: 'Inter', sans-serif; background: var(--mariposa-black); margin: 0; color: var(--white); overflow-x: hidden; }
        .full-width { max-width: 100% !important; margin: 0 !important; }
        
        /* Layout */
        .navbar { 
            background: linear-gradient(90deg, #000 0%, var(--mariposa-dark-grey) 100%); 
            color: var(--mariposa-pink); padding: 15px 25px; display: flex; 
            justify-content: space-between; align-items: center; border-bottom: 2px solid var(--mariposa-hot);
            position: sticky; top: 0; z-index: 1000; 
        }
        .logo-area { display: flex; align-items: center; gap: 10px; font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 900; }
        .container { max-width: 1400px; margin: 20px auto; padding: 0 15px; }
        .dashboard-grid { display: grid; grid-template-columns: 450px 1fr; gap: 20px; }
        
        /* Cards & UI */
        .card { 
            background: var(--mariposa-dark-grey); border-radius: 15px; padding: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px; 
            border: 1px solid rgba(255,133,162,0.1);
        }
        .insight-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        #sentimentEmoji { font-size: 40px; }

        /* Summary Box */
        .summary-box { background: #000; border-left: 4px solid var(--mariposa-hot); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .summary-box h4 { margin: 0 0 10px 0; color: var(--mariposa-pink); font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .priority-item { font-size: 12px; margin-bottom: 8px; color: #ccc; display: flex; align-items: flex-start; gap: 8px; }
        .priority-num { background: var(--mariposa-hot); color: #fff; font-weight: 900; padding: 2px 6px; border-radius: 4px; font-size: 10px; }

        textarea { 
            width: 100%; height: 180px; border: 1px solid #333; border-radius: 10px; 
            padding: 15px; background: #000; color: #fff; outline: none; font-size: 13px;
        }
        .btn { padding: 12px 20px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--mariposa-hot); color: white; width: 100%; margin-top: 10px; }
        
        .response-options { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        .opt-box { background: #1a1a1a; padding: 10px; border-radius: 8px; border: 1px solid #333; cursor: pointer; font-size: 11px; }
        .opt-box:hover { border-color: var(--mariposa-pink); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: #000; border-radius: 10px; overflow: hidden; }
        th { background: #222; color: var(--mariposa-pink); padding: 12px; font-size: 11px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #222; font-size: 13px; }

        .tag { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 900; color: #000; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .analyzing { animation: pulse 1s infinite; color: var(--mariposa-pink); font-weight: bold; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo-area">ðŸŒº D.Z. MARIPOSA NLP v12</div>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:var(--mariposa-dark-grey); color:white" onclick="toggleFit()">ðŸ“± Fit</button>
            <button class="btn" style="background:var(--pos); color:black" onclick="exportToExcel()">ðŸ“¥ Export Report</button>
        </div>
    </nav>

    <div class="container" id="mainContainer">
        <div class="dashboard-grid">
            <div class="sidebar">
                <div class="card">
                    <h3 style="margin-top:0; color:var(--mariposa-pink)">Batch Smart Intake</h3>
                    <p style="font-size: 11px; color:#888;">Paste multiple reviews (one per line) for a weekly executive summary.</p>
                    <textarea id="reviewInput" placeholder="Review 1&#10;Review 2&#10;Review 3..."></textarea>
                    <button class="btn btn-main" onclick="processBatch()">âš¡ BATCH ANALYZE</button>
                </div>

                <div class="card">
                    <h3 style="margin:0; font-size: 16px; color:var(--mariposa-pink)">Trend Projection</h3>
                    <div style="height:220px;"><canvas id="lineChart"></canvas></div>
                </div>
            </div>

            <div class="main-content">
                <div class="card" id="executiveSummary" style="display:none;">
                    <div class="summary-box">
                        <h4>ðŸ“‹ Weekly Executive Priority Fix</h4>
                        <div id="priorityList"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="insight-header">
                        <span id="sentimentEmoji">ðŸ™‚</span>
                        <h3 style="margin:0; color:var(--mariposa-pink)">Painpoint & Resolution Hub</h3>
                    </div>
                    <table>
                        <thead>
                            <tr><th width="30%">Category</th><th width="10%">Freq</th><th>Strategy</th></tr>
                        </thead>
                        <tbody id="insightBody"></tbody>
                    </table>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 15px 0; color:var(--mariposa-pink)">Detailed Analysis History</h3>
                    <div id="historyList"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('dz_mariposa_v12')) || [];

    const lexicon = {
        positive: ['hiyang', 'glow', 'effective', 'legit', 'orig', 'kinis', 'smooth', 'mabait', 'dasurb', 'slay', 'ate chrue', 'bet', 'budol find', 'sulit', 'fast delivery', 'securely packed'],
        negative: ['hapdi', 'kirot', 'pimple', 'tigyawat', 'butlig', 'fake', 'peke', 'scam', 'sayang', 'mahal', 'bad', 'worst', 'nagsisi', 'sunog', 'irritation', 'dry', 'leaking', 'bawas', 'tampered', 'rude', 'suplado', 'attitude', 'overrated', 'mid', 'clownery', 'delulu', 'rash', 'itchy', 'allergic', 'late', 'failed', 'misplaced', 'unresponsive', 'hidden charges', 'expired', 'oxidized'],
        themes: [
            { id: 'clinical', label: 'Adverse Skin Reaction', keywords: ['hapdi', 'kirot', 'pimple', 'butlig', 'rash', 'itchy', 'hives', 'burning', 'redness'], fix: 'Trigger Skin Safety Protocol.' },
            { id: 'quality', label: 'Product Integrity', keywords: ['fake', 'peke', 'scam', 'separated', 'watery', 'metallic', 'foul', 'texture', 'oxidized', 'bawas', 'expired'], fix: 'Audit Manufacturing Batch.' },
            { id: 'logistics', label: 'Delivery/Service Issue', keywords: ['rider', 'tagal', 'suplado', 'bastos', 'delivery', 'thrown', 'damaged', 'leaking', 'late', 'hidden charges', 'failed'], fix: 'Review 3PL Performance.' }
        ]
    };

    function processBatch() {
        const lines = document.getElementById('reviewInput').value.split('\n').filter(l => l.trim().length > 0);
        if(lines.length === 0) return;

        lines.forEach(text => {
            const words = text.toLowerCase().split(/\W+/);
            let posCount = words.filter(w => lexicon.positive.includes(w)).length;
            let negCount = words.filter(w => lexicon.negative.includes(w)).length;
            let score = (posCount - negCount) / (words.length / 5 + 1);
            score = Math.max(-1, Math.min(1, score));

            let sentiment = score > 0.12 ? "Positive" : (score < -0.12 ? "Negative" : "Neutral");
            let foundThemes = lexicon.themes.filter(t => t.keywords.some(k => text.toLowerCase().includes(k)));

            db.push({
                id: Date.now() + Math.random(),
                text: text,
                sentiment: sentiment,
                score: score,
                themes: foundThemes.map(t => t.label),
                responses: generateResponses(text, sentiment, foundThemes),
                timestamp: new Date().toLocaleString()
            });
        });

        localStorage.setItem('dz_mariposa_v12', JSON.stringify(db));
        document.getElementById('reviewInput').value = "";
        updateDashboard();
        generateExecutiveSummary();
    }

    function generateExecutiveSummary() {
        const recent = db.slice(-50);
        const totals = {};
        recent.forEach(entry => entry.themes.forEach(t => totals[t] = (totals[t] || 0) + 1));
        
        const sorted = Object.entries(totals).sort((a,b) => b[1] - a[1]).slice(0, 3);
        const summaryBox = document.getElementById('executiveSummary');
        const list = document.getElementById('priorityList');
        
        if(sorted.length > 0) {
            summaryBox.style.display = 'block';
            list.innerHTML = sorted.map((item, index) => `
                <div class="priority-item">
                    <span class="priority-num">${index+1}</span>
                    <span><b>${item[0]}:</b> Detected in ${item[1]} reviews. Action: ${lexicon.themes.find(th => th.label === item[0]).fix}</span>
                </div>
            `).join('');
        }
    }

    function generateResponses(text, sentiment, themes) {
        if(sentiment === "Positive") return { empathy: "Stay glowing! âœ¨", tactical: "Code: GLOW10", professional: "Thank you for your feedback." };
        return {
            empathy: "We're so sorry for this experience. ðŸ¥º",
            tactical: "Please DM your Batch ID for a refund.",
            professional: "We are conducting a quality audit regarding this report."
        };
    }

    function updateDashboard() {
        const pos = db.filter(i => i.sentiment === 'Positive').length;
        const neg = db.filter(i => i.sentiment === 'Negative').length;
        document.getElementById('sentimentEmoji').innerText = pos > neg ? "ðŸ˜" : (neg > pos ? "ðŸ˜”" : "ðŸ™‚");

        const classifier = {};
        db.forEach(entry => entry.themes.forEach(t => classifier[t] = (classifier[t] || 0) + 1));
        document.getElementById('insightBody').innerHTML = Object.keys(classifier).map(key => `
            <tr><td><b>${key}</b></td><td align="center">${classifier[key]}</td><td>${lexicon.themes.find(t => t.label === key).fix}</td></tr>
        `).join('');

        render();
        updateCharts();
    }

    let lineChart;
    function updateCharts() {
        const ctx = document.getElementById('lineChart').getContext('2d');
        if(lineChart) lineChart.destroy();
        const last15 = db.slice(-15);
        lineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: last15.map(i => i.timestamp),
                datasets: [{
                    data: last15.map(i => i.score),
                    borderColor: '#ff85a2', backgroundColor: 'rgba(214, 51, 132, 0.1)',
                    fill: true, tension: 0.4
                }]
            },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    }

    function render() {
        document.getElementById('historyList').innerHTML = db.slice(-20).reverse().map(i => `
            <div style="border-bottom:1px solid #333; padding:15px 0;">
                <span class="tag" style="background:${i.score < -0.4 ? 'var(--critical)' : (i.sentiment==='Positive'?'var(--pos)':'#ffa502')}">${i.sentiment}</span>
                <p style="font-size:13px; margin:10px 0;">"${i.text}"</p>
                <div class="response-options">
                    <div class="opt-box" onclick="alert('Copied!')"><b>Empathy:</b> ${i.responses.empathy}</div>
                    <div class="opt-box" onclick="alert('Copied!')"><b>Tactical:</b> ${i.responses.tactical}</div>
                    <div class="opt-box" onclick="alert('Copied!')"><b>Prof:</b> ${i.responses.professional}</div>
                </div>
            </div>
        `).join('');
    }

    function clearDatabase() { if(confirm("Clear data?")) { localStorage.removeItem('dz_mariposa_v12'); db=[]; location.reload(); } }
    function toggleFit() { document.getElementById('mainContainer').classList.toggle('full-width'); }
    function exportToExcel() {
        XLSX.writeFile(XLSX.utils.book_append_sheet(XLSX.utils.book_new(), XLSX.utils.json_to_sheet(db), "Report"), "Mariposa_v12.xlsx");
    }
    updateDashboard();
</script>
</body>
</html>

