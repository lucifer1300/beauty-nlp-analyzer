
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty Products Professional AI NLP</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --main: #d63384; --dark: #1a1d20; --bg: #f8f9fa; --white: #ffffff; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; color: #333; }
        .navbar { background: var(--dark); color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }
        .dashboard-grid { display: grid; grid-template-columns: 420px 1fr; gap: 20px; }
        @media (max-width: 950px) { .dashboard-grid { grid-template-columns: 1fr; } }
        .card { background: var(--white); border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        textarea { width: 100%; height: 200px; border: 1px solid #ddd; border-radius: 8px; padding: 12px; font-size: 14px; resize: none; box-sizing: border-box; outline-color: var(--main); line-height: 1.6; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; margin-top: 10px; }
        .btn-main { background: var(--main); color: white; font-size: 16px; box-shadow: 0 4px 15px rgba(214, 51, 132, 0.3); }
        .btn-excel { background: #1f7244; color: white; width: auto; padding: 10px 20px; }
        .btn-copy { background: #636e72; color: white; width: auto; padding: 6px 15px; font-size: 11px; margin-top: 8px; float: right; border-radius: 5px; }
        .search-box { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 15px; padding-left: 35px; background: #fff url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="gray"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>') no-repeat 10px center; }
        .item { border-bottom: 1px solid #eee; padding: 25px 0; }
        .badge { padding: 4px 10px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; margin-right: 5px; }
        .tag-skin { background: #ffeaa7; color: #d35400; }
        .tag-rider { background: #fab1a0; color: #e17055; }
        .tag-neg { background: #ff7675; color: white; }
        .tag-pos { background: #55efc4; color: #006266; }
        .response-card { background: #fdf2f7; border-left: 5px solid var(--main); padding: 15px; margin-top: 15px; font-size: 14px; border-radius: 4px; line-height: 1.6; clear: both; color: #444; }
        .strategy-box { background: #f1f3f5; border-radius: 6px; padding: 12px; margin-top: 10px; font-size: 13px; color: #2d3436; border-left: 5px solid #636e72; }
        .context-found { font-size: 11px; color: #888; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div style="font-weight: 800; letter-spacing: 1px; font-size: 20px;">ðŸŒ¸ BEAUTY PRO AI NLP</div>
        <button class="btn btn-excel" onclick="exportToExcel()">ðŸ“¥ Export Analysis Report</button>
    </nav>

    <div class="container">
        <div class="dashboard-grid">
            <div>
                <div class="card">
                    <h3 style="margin-top:0">Advanced Review Intake</h3>
                    <p style="font-size: 12px; color: #666;">Optimized for long Taglish paragraphs & complex complaints.</p>
                    <textarea id="reviewInput" placeholder="Paste the entire long review here..."></textarea>
                    <button class="btn btn-main" onclick="analyzeComplex()">Deep Context Analysis</button>
                    <button onclick="clearHistory()" style="background:none; border:none; color:#bbb; font-size:11px; margin-top:15px; cursor:pointer; width:100%;">Reset Analyzer Cache</button>
                </div>
                <div class="card">
                    <h3 style="margin-top:0">Sentiment Distribution</h3>
                    <canvas id="chartArea"></canvas>
                </div>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0">Analysis History</h3>
                    <input type="text" id="search" class="search-box" style="width:250px; margin:0;" placeholder="Search keywords..." onkeyup="render()">
                </div>
                <div id="historyList"></div>
            </div>
        </div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('beauty_pro_deep_v1')) || [];

    const jejeMap = { "22o":"totoo", "q":"ko", "aq":"ako", "muka":"mukha", "wla":"wala", "d":"hindi", "u":"ikaw", "uminit":"mainit", "hapdi":"mahapdi", "epek":"effect" };

    // Deep Context Logic
    function analyzeComplex() {
        const rawText = document.getElementById('reviewInput').value.trim();
        if(!rawText) return;

        // Step 1: Normalize Text
        let cleanText = rawText.toLowerCase();
        Object.keys(jejeMap).forEach(key => {
            cleanText = cleanText.replace(new RegExp(`\\b${key}\\b`, 'g'), jejeMap[key]);
        });

        // Step 2: Sentence Segmentation
        const sentences = cleanText.split(/[.!?\n]+/).filter(s => s.trim().length > 0);

        let detectedIssues = new Set();
        let riskScore = 1;
        let sentiment = "Neutral";
        let contextClues = [];

        // Step 3: Deep Scan per Sentence
        sentences.forEach(s => {
            // Skin Context
            if (/(tigyawat|bumps|butlig|hapdi|kirot|init|kati|mula|sunog|pimple|breakout|rash)/i.test(s)) {
                detectedIssues.add("Skin Reaction");
                riskScore += 2;
                contextClues.push("Skin concern detected in sentences.");
            }
            // Rider Context
            if (/(rider|delivery|kuya|attitude|bastos|mura|ugali|suplado|snob|matagal)/i.test(s)) {
                detectedIssues.add("Rider Behavior");
                riskScore += 2;
                contextClues.push("Logistics/Behavior concern detected.");
            }
            // Quality Context
            if (/(fake|peke|scam|legit|orig|basag|tapon|alcohol|authentic|budol)/i.test(s)) {
                detectedIssues.add("Product Quality");
                riskScore += 1;
            }
        });

        // Step 4: Aggregate Sentiment
        const positiveTriggers = /(hiyang|kinis|glow|puti|smooth|effective|maganda|mabait|salamat|satisfied)/i;
        const negativeTriggers = /(sayang|mahal|hindi|pangit|bad|worst|disappointed|nagsisisi|ibabalik)/i;

        if (riskScore >= 4 || negativeTriggers.test(cleanText)) {
            sentiment = "Negative";
        } else if (positiveTriggers.test(cleanText) && riskScore < 3) {
            sentiment = "Positive";
        }

        // Step 5: Professional Response Selection
        let response = "";
        let strategy = "";
        let issuesArr = Array.from(detectedIssues);

        if (issuesArr.includes("Skin Reaction")) {
            response = "Thank you for bringing this to our attention immediately. Your safety is our absolute priority. Please discontinue use of the product right away. Maaari po kayong mag-apply ng cold compress at uminom ng maraming tubig. We will contact you via DM to monitor your skin's condition.";
            strategy = "CRITICAL: Urgent health follow-up needed. Advise immediate stop and offer refund/consultation.";
        } else if (issuesArr.includes("Rider Behavior")) {
            response = "Pasensya na po sa naging karanasan ninyo kay Rider. Hindi po namin kinukunsinti ang ganyang behavior. I-re-report po namin ito sa aming courier partner branch para mabigyan ng kaukulang aksyon at hindi na maulit.";
            strategy = "LOGISTICS: File formal complaint to the courier branch. Request a different rider for this area.";
        } else if (sentiment === "Positive") {
            response = "Thank you for your trust on our brand, we hope we are able to satisfy you till the end! âœ¨ We are so happy na naging hiyang kayo. Stay glowing!";
            strategy = "MARKETING: High-value customer. Potential for repeat purchase or brand ambassador.";
        } else {
            response = "Maraming salamat po sa inyong honest feedback. Gagamitin po namin ito upang lalong mapaganda ang aming produkto at serbisyo para sa inyo.";
            strategy = "SERVICE: General feedback noted for batch improvement.";
        }

        db.push({ id: Date.now(), original: rawText, sentiment, issues: issuesArr, response, strategy, date: new Date().toLocaleString(), clues: contextClues });
        localStorage.setItem('beauty_pro_deep_v1', JSON.stringify(db));
        document.getElementById('reviewInput').value = "";
        updateDashboard();
    }

    function render() {
        const search = document.getElementById('search').value.toLowerCase();
        const list = document.getElementById('historyList');
        const filtered = db.filter(i => i.original.toLowerCase().includes(search));
        
        list.innerHTML = filtered.length ? filtered.reverse().map(i => `
            <div class="item">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span class="badge ${i.sentiment === 'Positive' ? 'tag-pos' : 'tag-neg'}">${i.sentiment}</span>
                        ${i.issues.map(tag => `<span class="badge ${tag.includes('Skin')?'tag-skin':'tag-rider'}">${tag}</span>`).join('')}
                    </div>
                    <small style="color:#999;">${i.date}</small>
                </div>
                <p style="margin:12px 0; font-size:14px; line-height:1.6; color:#2d3436; background:#fdfdfd; padding:10px; border-radius:5px;">"${i.original}"</p>
                <button class="btn-copy" onclick="copyResponse('${i.id}')">ðŸ“‹ Copy Professional Response</button>
                <div class="response-card" id="resp-${i.id}">
                    <b style="color:var(--main); font-size:11px; text-transform:uppercase; letter-spacing:1px;">âœ¨ Suggested Response</b><br>${i.response}
                </div>
                <div class="strategy-box">
                    <b>ðŸ’¡ Best Thing to Do (Host Strategy):</b><br>${i.strategy}
                </div>
            </div>
        `).join('') : '<p style="text-align:center; color:#999; margin-top:50px;">No matching complex reviews found.</p>';
    }

    function copyResponse(id) {
        const item = db.find(x => x.id == id);
        if (item) {
            navigator.clipboard.writeText(item.response).then(() => {
                const btn = event.target;
                btn.innerText = "âœ… Copied to Clipboard";
                btn.style.backgroundColor = "#2ecc71";
                setTimeout(() => { btn.innerText = "ðŸ“‹ Copy Professional Response"; btn.style.backgroundColor = "#636e72"; }, 2000);
            });
        }
    }

    function updateDashboard() {
        render();
        const pos = db.filter(i => i.sentiment === "Positive").length;
        const neg = db.filter(i => i.sentiment === "Negative").length;
        const neu = db.length - (pos + neg);
        updateChart(pos, neg, neu);
    }

    function exportToExcel() {
        if(!db.length) return alert("Nothing to export.");
        const ws = XLSX.utils.json_to_sheet(db);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "AnalysisHistory");
        XLSX.writeFile(wb, "Beauty_Pro_Deep_Report.xlsx");
    }

    let myChart;
    function updateChart(p, n, u) {
        const ctx = document.getElementById('chartArea').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: { labels: ['Happy', 'Critical', 'Neutral'], datasets: [{ data:[p, n, u], backgroundColor: ['#2ecc71', '#ff7675', '#dfe6e9'], borderWidth: 0 }] },
            options: { cutout: '75%', plugins: { legend: { position: 'bottom' } } }
        });
    }

    function clearHistory() {
        if(confirm("Permanently clear analysis history?")) {
            localStorage.removeItem('beauty_pro_deep_v1');
            db = [];
            location.reload();
        }
    }
    updateDashboard();
</script>
</body>
</html>
